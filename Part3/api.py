#!/usr/bin/env python
# coding: utf-8

# In[25]:


get_ipython().run_cell_magic('writefile', 'api.py', '\nfrom flask import Flask, request, render_template\nimport pandas as pd\nimport pickle\nfrom car_data_prep import prepare_data  # ייבוא פונקציית prepare_data מקובץ car_data_prep.py\n\napp = Flask(__name__)\n\n# טעינת המודל המאומן מתוך קובץ PKL\nwith open(\'trained_model.pkl\', \'rb\') as f:\n    model = pickle.load(f)\n\n@app.route(\'/\')\ndef index():\n    return render_template(\'index.html\')\n\n@app.route(\'/predict\', methods=[\'POST\'])\ndef predict():\n    # קבלת הנתונים מהטופס\n    manufactor = request.form[\'manufactor\']\n    year = int(request.form[\'year\'])\n    model_car = request.form[\'model\']\n    hand = int(request.form[\'hand\'])\n    gear = request.form[\'gear\']\n    capacity_engine = float(request.form[\'capacity_engine\'])\n    engine_type = request.form[\'engine_type\']\n    prev_ownership = request.form[\'prev_ownership\']  # טקסט\n    curr_ownership = request.form[\'curr_ownership\']  # טקסט\n    area = request.form[\'area\']\n    city = request.form[\'city\']\n    pic_num = int(request.form[\'pic_num\'])  # מספר תמונות\n    description = request.form[\'description\']\n    color = request.form[\'color\']\n    km = float(request.form[\'km\'])\n    test = request.form[\'test\']\n    supply_score = float(request.form[\'supply_score\'])\n\n    # יצירת DataFrame מהנתונים\n    data = pd.DataFrame([[manufactor, year, model_car, hand, gear, capacity_engine, engine_type, prev_ownership, curr_ownership, area, city, pic_num, description, color, km, test, supply_score]], \n                        columns=[\'manufactor\', \'Year\', \'model\', \'Hand\', \'Gear\', \'capacity_Engine\', \'Engine_type\', \'Prev_ownership\', \'Curr_ownership\', \'Area\', \'City\', \'Pic_num\', \'Description\', \'Color\', \'Km\', \'Test\', \'Supply_score\'])\n\n    \n    print("Initial DataFrame:")\n    print(data)\n    \n    \n    # עיבוד הנתונים באמצעות prepare_data\n    processed_data = prepare_data(data)\n    \n    print("Initial DataFrame:")\n    print(data)\n\n    # חיזוי המחיר באמצעות המודל\n    prediction = model.predict(processed_data)[0]\n\n    # החזרת התוצאה לעמוד ה-HTML\n    return f"The predicted price is: {prediction:.2f} shekels"\n\nif __name__ == \'__main__\':\n    app.run(debug=True)')

